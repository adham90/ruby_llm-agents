<%
  # Router workflow structure visualization
  # Shows classifier branching to different routes
  routes = local_assigns[:routes] || []
  default_route = routes.find { |r| r[:default] }
%>

<% if routes.any? %>
  <!-- Visual Router Flow -->
  <div class="py-4">
    <div class="flex items-start gap-6">
      <!-- Classifier Box -->
      <div class="flex flex-col items-center">
        <div class="w-24 h-12 flex items-center justify-center rounded-lg border-2 border-amber-300 dark:border-amber-600 bg-amber-50 dark:bg-amber-900/30">
          <span class="text-sm font-semibold text-amber-700 dark:text-amber-300">classify</span>
        </div>
      </div>

      <!-- Routes Fan-out -->
      <div class="flex-1 relative">
        <!-- Connection Lines (visual only) -->
        <div class="absolute left-0 top-0 bottom-0 w-8 flex flex-col justify-around items-end">
          <% routes.each do |route| %>
            <div class="text-amber-400 dark:text-amber-500">
              <svg class="w-6 h-4" viewBox="0 0 24 16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M0 8 L12 8 L18 8" stroke-linecap="round"/>
                <path d="M14 4 L18 8 L14 12" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          <% end %>
        </div>

        <!-- Route Boxes -->
        <div class="space-y-2 ml-10">
          <% routes.each do |route| %>
            <div class="flex items-center gap-3 py-2 px-3 rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 <%= route[:default] ? 'border-dashed' : '' %>">
              <span class="font-semibold text-amber-700 dark:text-amber-300 min-w-24">
                <%= route[:name] %>
              </span>
              <span class="text-amber-400 dark:text-amber-500">-></span>
              <code class="text-sm font-mono text-gray-600 dark:text-gray-400">
                <%= route[:agent] %>
              </code>
              <% if route[:description].present? %>
                <span class="text-xs text-gray-500 dark:text-gray-400 italic truncate max-w-xs ml-2" title="<%= route[:description] %>">
                  "<%= route[:description].truncate(40) %>"
                </span>
              <% end %>
              <% if route[:default] %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 ml-auto">
                  fallback
                </span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Route Details Table -->
  <div class="border-t border-gray-100 dark:border-gray-700 pt-4 mt-4">
    <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">
      Route Details
    </p>

    <div class="space-y-2">
      <% routes.each do |route| %>
        <div class="flex items-start gap-3 py-2 px-3 rounded-lg bg-gray-50 dark:bg-gray-900/50">
          <span class="w-6 h-6 flex items-center justify-center rounded-full <%= route[:default] ? 'bg-gray-200 dark:bg-gray-700' : 'bg-amber-100 dark:bg-amber-900/50' %> text-xs font-medium <%= route[:default] ? 'text-gray-600 dark:text-gray-400' : 'text-amber-600 dark:text-amber-300' %> mt-0.5">
            <% if route[:default] %>
              *
            <% else %>
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            <% end %>
          </span>
          <div class="flex-1">
            <div class="flex items-center gap-3">
              <span class="font-medium text-gray-700 dark:text-gray-300">
                <%= route[:name] %>
              </span>
              <span class="text-gray-400 dark:text-gray-500 text-sm">-></span>
              <code class="text-sm font-mono text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded">
                <%= route[:agent] %>
              </code>
              <% if route[:default] %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400">
                  fallback route
                </span>
              <% end %>
            </div>
            <% if route[:description].present? %>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                <%= route[:description] %>
              </p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <p class="text-gray-500 dark:text-gray-400 italic py-4">
    No routes defined for this router workflow.
  </p>
<% end %>
