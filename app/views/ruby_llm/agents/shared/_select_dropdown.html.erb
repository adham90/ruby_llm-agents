<%
  # Single-select filter dropdown with Alpine.js
  # Usage:
  #   render "ruby_llm/agents/shared/select_dropdown",
  #     name: "days",
  #     filter_id: "days",
  #     options: [
  #       { value: "", label: "All Time" },
  #       { value: "7", label: "Last 7 Days" }
  #     ],
  #     selected: "7"

  selected = local_assigns[:selected].to_s
  current_option = options.find { |o| o[:value].to_s == selected } || options.first
  current_label = current_option[:label]
  has_selection = selected.present?
%>
<div class="relative" x-data="{ open: false }" @click.outside="open = false" data-filter="<%= filter_id %>">
  <button type="button" @click="open = !open"
    class="flex items-center gap-1.5 px-2 py-1 font-mono text-xs rounded
           hover:bg-gray-100 dark:hover:bg-gray-800/50 transition-colors
           <%= has_selection ? 'text-gray-900 dark:text-gray-100' : 'text-gray-400 dark:text-gray-500' %>">
    <span><%= current_label %></span>
    <svg class="w-3 h-3 text-gray-400 dark:text-gray-600 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </button>

  <div x-show="open" x-cloak x-transition:enter="transition ease-out duration-100"
       x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
       x-transition:leave="transition ease-in duration-75"
       x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
       class="absolute z-20 mt-1 min-w-max bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1">
    <% options.each do |option| %>
      <%
        is_selected = option[:value].to_s == selected
      %>
      <button type="button"
              @click="
                document.getElementById('filter_<%= filter_id %>').value = '<%= option[:value] %>';
                open = false;
                $el.closest('form').requestSubmit();
              "
              class="w-full flex items-center gap-2 px-3 py-1.5 font-mono text-xs text-left
                     <%= is_selected ? 'text-gray-900 dark:text-gray-100' : 'text-gray-500 dark:text-gray-400' %>
                     hover:bg-gray-50 dark:hover:bg-gray-700">
        <%= option[:label] %>
        <% if is_selected %>
          <span class="ml-auto text-gray-400 dark:text-gray-600">&check;</span>
        <% end %>
      </button>
    <% end %>
  </div>

  <input type="hidden" name="<%= name %>" value="<%= selected %>" id="filter_<%= filter_id %>">
</div>
