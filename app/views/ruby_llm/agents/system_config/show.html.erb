<%
  retries = @config.default_retries || {}
  has_retries = (retries[:max] || 0) > 0
  has_fallbacks = @config.default_fallback_models.present? && @config.default_fallback_models.any?
  has_total_timeout = @config.default_total_timeout.present?
  budgets = @config.budgets || {}
  budgets_enabled = @config.budgets_enabled?
  alerts_enabled = @config.on_alert.respond_to?(:call)
  redaction = @config.redaction || {}
  redaction_enabled = redaction.present?
%>

<!-- ── system config ──────────────── -->
<div class="flex items-center gap-3 mb-1.5">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">system configuration</span>
  <div class="font-mono text-xs text-gray-400 dark:text-gray-500 flex items-center gap-1.5">
    <%= render "ruby_llm/agents/shared/doc_link" %>
  </div>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs text-gray-400 dark:text-gray-600 mb-6">
  configured in <span class="text-gray-500 dark:text-gray-400">config/initializers/ruby_llm_agents.rb</span>
</div>

<!-- ── model defaults ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">model defaults</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">default model</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.default_model %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">temperature</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.default_temperature %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">timeout</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.default_timeout %>s</span>
  </div>
</div>

<!-- ── execution logging ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">execution logging</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">async logging</span>
    <span class="badge <%= @config.async_logging ? 'badge-success' : 'badge-timeout' %>" style="font-size: 10px; padding: 1px 6px;"><%= @config.async_logging ? 'on' : 'off' %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">retention</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.retention_period.inspect %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">job retries</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.job_retry_attempts %></span>
  </div>
</div>

<!-- ── caching ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">caching</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">cache store</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.cache_store.class.name %></span>
  </div>
</div>

<!-- ── anomaly detection ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">anomaly detection</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">cost threshold</span>
    <span class="text-gray-900 dark:text-gray-200">$<%= @config.anomaly_cost_threshold %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">duration threshold</span>
    <span class="text-gray-900 dark:text-gray-200"><%= number_with_delimiter(@config.anomaly_duration_threshold) %>ms</span>
  </div>
</div>

<!-- ── dashboard settings ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">dashboard</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">per page</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.per_page %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">recent limit</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.recent_executions_limit %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">parent controller</span>
    <span class="text-gray-900 dark:text-gray-200"><%= @config.dashboard_parent_controller %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">basic auth</span>
    <% if @config.basic_auth_username.present? && @config.basic_auth_password.present? %>
      <span class="badge badge-success" style="font-size: 10px; padding: 1px 6px;">configured</span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">custom auth</span>
    <% if @config.dashboard_auth.present? %>
      <span class="badge badge-success" style="font-size: 10px; padding: 1px 6px;">configured</span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
</div>

<!-- ── reliability ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">reliability defaults</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">retries</span>
    <% if has_retries %>
      <span class="text-gray-900 dark:text-gray-200"><%= retries[:max] %> max</span>
      <span class="text-gray-300 dark:text-gray-700">&middot;</span>
      <span class="text-gray-400 dark:text-gray-600"><%= retries[:backoff] %> backoff</span>
      <span class="text-gray-300 dark:text-gray-700">&middot;</span>
      <span class="text-gray-400 dark:text-gray-600"><%= retries[:base] %>s base</span>
      <span class="text-gray-300 dark:text-gray-700">&middot;</span>
      <span class="text-gray-400 dark:text-gray-600"><%= retries[:max_delay] %>s max</span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">fallback models</span>
    <% if has_fallbacks %>
      <span class="text-gray-900 dark:text-gray-200"><%= @config.default_fallback_models.join(" → ") %></span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">total timeout</span>
    <% if has_total_timeout %>
      <span class="text-gray-900 dark:text-gray-200"><%= @config.default_total_timeout %>s</span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
</div>

<!-- ── governance ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">governance</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">budget enforcement</span>
    <% if budgets_enabled %>
      <%
        enforcement_badge = @config.budget_enforcement == :hard ? "badge-error" : "badge-timeout"
      %>
      <span class="badge <%= enforcement_badge %>" style="font-size: 10px; padding: 1px 6px;"><%= @config.budget_enforcement %></span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
  <% if budgets_enabled %>
    <% if budgets[:global_daily] %>
      <div class="flex items-center gap-3 py-0.5 pl-4">
        <span class="w-32 flex-shrink-0 text-gray-400 dark:text-gray-600">global daily</span>
        <span class="text-gray-900 dark:text-gray-200">$<%= budgets[:global_daily] %></span>
      </div>
    <% end %>
    <% if budgets[:global_monthly] %>
      <div class="flex items-center gap-3 py-0.5 pl-4">
        <span class="w-32 flex-shrink-0 text-gray-400 dark:text-gray-600">global monthly</span>
        <span class="text-gray-900 dark:text-gray-200">$<%= budgets[:global_monthly] %></span>
      </div>
    <% end %>
    <% if budgets[:per_agent_daily].present? %>
      <div class="py-0.5 pl-4">
        <span class="text-gray-400 dark:text-gray-600">per-agent daily:</span>
        <% budgets[:per_agent_daily].each do |agent, limit| %>
          <div class="flex items-center gap-2 pl-2 py-0.5">
            <span class="text-gray-900 dark:text-gray-200"><%= agent %></span>
            <span class="text-gray-400 dark:text-gray-600">$<%= limit %></span>
          </div>
        <% end %>
      </div>
    <% end %>
    <% if budgets[:per_agent_monthly].present? %>
      <div class="py-0.5 pl-4">
        <span class="text-gray-400 dark:text-gray-600">per-agent monthly:</span>
        <% budgets[:per_agent_monthly].each do |agent, limit| %>
          <div class="flex items-center gap-2 pl-2 py-0.5">
            <span class="text-gray-900 dark:text-gray-200"><%= agent %></span>
            <span class="text-gray-400 dark:text-gray-600">$<%= limit %></span>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">alert handler</span>
    <% if alerts_enabled %>
      <span class="badge badge-success" style="font-size: 10px; padding: 1px 6px;">configured</span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
</div>

<!-- ── data handling ──────────────── -->
<div class="flex items-center gap-3 mt-6 mb-3">
  <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">data handling</span>
  <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
</div>
<div class="font-mono text-xs space-y-1.5">
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">persist prompts</span>
    <span class="badge <%= @config.persist_prompts ? 'badge-success' : 'badge-timeout' %>" style="font-size: 10px; padding: 1px 6px;"><%= @config.persist_prompts ? 'on' : 'off' %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">persist responses</span>
    <span class="badge <%= @config.persist_responses ? 'badge-success' : 'badge-timeout' %>" style="font-size: 10px; padding: 1px 6px;"><%= @config.persist_responses ? 'on' : 'off' %></span>
  </div>
  <div class="flex items-center gap-3 py-0.5">
    <span class="w-36 flex-shrink-0 text-gray-500 dark:text-gray-400">pii redaction</span>
    <% if redaction_enabled %>
      <span class="badge badge-success" style="font-size: 10px; padding: 1px 6px;">on</span>
      <span class="text-gray-400 dark:text-gray-600"><%= @config.redaction_fields.count %> fields</span>
      <span class="text-gray-300 dark:text-gray-700">&middot;</span>
      <span class="text-gray-400 dark:text-gray-600"><%= @config.redaction_patterns.count %> patterns</span>
    <% else %>
      <span class="text-gray-300 dark:text-gray-700">—</span>
    <% end %>
  </div>
</div>

<!-- Footer note -->
<div class="mt-8 font-mono text-[10px] text-gray-400 dark:text-gray-600">
  these settings are read-only — edit <span class="text-gray-500 dark:text-gray-400">config/initializers/ruby_llm_agents.rb</span> and restart to change
</div>
