<%# Tenant Budget Widget - shows budget limits and usage for current tenant %>
<%# @param tenant_budget [Hash] Budget data from controller %>

<% if tenant_budget.present? %>
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 mb-6">
    <div class="px-6 py-3 border-b border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
          </svg>
          <h3 class="text-base font-semibold text-gray-900 dark:text-gray-100">
            Tenant Budget: <%= tenant_budget[:tenant_id] %>
          </h3>
        </div>
        <%# Enforcement badge %>
        <% enforcement = tenant_budget[:enforcement].to_s %>
        <% badge_class = case enforcement
             when "hard" then "bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300"
             when "soft" then "bg-yellow-100 dark:bg-yellow-900/50 text-yellow-700 dark:text-yellow-300"
             else "bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"
           end %>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= badge_class %>">
          <%= enforcement.capitalize %> Enforcement
        </span>
      </div>
    </div>

    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <%# Daily Budget %>
        <div>
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Daily Budget</span>
            <span class="text-sm text-gray-500 dark:text-gray-400">
              $<%= number_with_precision(tenant_budget[:daily_spend], precision: 2) %>
              <% if tenant_budget[:daily_limit] %>
                / $<%= number_with_precision(tenant_budget[:daily_limit], precision: 2) %>
              <% else %>
                (no limit)
              <% end %>
            </span>
          </div>
          <% if tenant_budget[:daily_limit] %>
            <% daily_pct = [tenant_budget[:daily_percentage], 100].min %>
            <% bar_color = if daily_pct >= 100
                             "bg-red-500"
                           elsif daily_pct >= 80
                             "bg-yellow-500"
                           else
                             "bg-green-500"
                           end %>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
              <div class="<%= bar_color %> h-2.5 rounded-full transition-all duration-300" style="width: <%= daily_pct %>%"></div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><%= tenant_budget[:daily_percentage] %>% used</p>
          <% else %>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
              <div class="bg-gray-400 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">No daily limit configured</p>
          <% end %>
        </div>

        <%# Monthly Budget %>
        <div>
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Monthly Budget</span>
            <span class="text-sm text-gray-500 dark:text-gray-400">
              $<%= number_with_precision(tenant_budget[:monthly_spend], precision: 2) %>
              <% if tenant_budget[:monthly_limit] %>
                / $<%= number_with_precision(tenant_budget[:monthly_limit], precision: 2) %>
              <% else %>
                (no limit)
              <% end %>
            </span>
          </div>
          <% if tenant_budget[:monthly_limit] %>
            <% monthly_pct = [tenant_budget[:monthly_percentage], 100].min %>
            <% bar_color = if monthly_pct >= 100
                             "bg-red-500"
                           elsif monthly_pct >= 80
                             "bg-yellow-500"
                           else
                             "bg-blue-500"
                           end %>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
              <div class="<%= bar_color %> h-2.5 rounded-full transition-all duration-300" style="width: <%= monthly_pct %>%"></div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><%= tenant_budget[:monthly_percentage] %>% used</p>
          <% else %>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
              <div class="bg-gray-400 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">No monthly limit configured</p>
          <% end %>
        </div>
      </div>

      <%# Per-agent limits if configured %>
      <% if tenant_budget[:per_agent_daily].present? %>
        <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-700">
          <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Per-Agent Daily Limits</p>
          <div class="flex flex-wrap gap-2">
            <% tenant_budget[:per_agent_daily].each do |agent, limit| %>
              <span class="inline-flex items-center px-2 py-1 rounded text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                <%= agent.to_s.gsub(/Agent$/, "") %>: $<%= number_with_precision(limit, precision: 2) %>
              </span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
