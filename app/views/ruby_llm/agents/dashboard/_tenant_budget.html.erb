<%# Tenant Budget Widget - shows budget limits and usage for current tenant %>
<%# @param tenant_budget [Hash] Budget data from controller %>

<% if tenant_budget.present? %>
  <%
    enforcement = tenant_budget[:enforcement].to_s
    enforcement_badge = case enforcement
      when "hard" then "badge-error"
      when "soft" then "badge-timeout"
      else ""
    end
  %>
  <div class="mb-6">
    <div class="flex items-center gap-3 mb-3">
      <span class="text-[10px] font-medium text-gray-400 dark:text-gray-600 uppercase tracking-widest font-mono">tenant budget: <%= tenant_budget[:tenant_id] %></span>
      <% if enforcement_badge.present? %>
        <span class="badge <%= enforcement_badge %> badge-sm"><%= enforcement %></span>
      <% end %>
      <div class="flex-1 border-t border-gray-200 dark:border-gray-800"></div>
    </div>

    <div class="font-mono text-xs space-y-2">
      <%# Daily Budget %>
      <% if tenant_budget[:daily_limit] %>
        <%
          daily_pct = [tenant_budget[:daily_percentage], 100].min
          bar_color = if daily_pct >= 100 then "bg-red-500"
                      elsif daily_pct >= 80 then "bg-yellow-500"
                      else "bg-green-500"
                      end
        %>
        <div class="flex items-center gap-3">
          <span class="w-28 flex-shrink-0 text-gray-500 dark:text-gray-400">daily</span>
          <span class="w-44 flex-shrink-0 text-gray-800 dark:text-gray-200">$<%= number_with_precision(tenant_budget[:daily_spend], precision: 2) %> <span class="text-gray-400 dark:text-gray-600">/ $<%= number_with_precision(tenant_budget[:daily_limit], precision: 2) %></span></span>
          <span class="w-12 flex-shrink-0 text-right text-gray-400 dark:text-gray-600"><%= tenant_budget[:daily_percentage] %>%</span>
          <div class="flex-1 bg-gray-200 dark:bg-gray-800 rounded-full h-1">
            <div class="<%= bar_color %> h-1 rounded-full transition-all" style="width: <%= daily_pct %>%"></div>
          </div>
        </div>
      <% else %>
        <div class="flex items-center gap-3">
          <span class="w-28 flex-shrink-0 text-gray-500 dark:text-gray-400">daily</span>
          <span class="text-gray-800 dark:text-gray-200">$<%= number_with_precision(tenant_budget[:daily_spend], precision: 2) %></span>
          <span class="text-gray-400 dark:text-gray-600">(no limit)</span>
        </div>
      <% end %>

      <%# Monthly Budget %>
      <% if tenant_budget[:monthly_limit] %>
        <%
          monthly_pct = [tenant_budget[:monthly_percentage], 100].min
          bar_color = if monthly_pct >= 100 then "bg-red-500"
                      elsif monthly_pct >= 80 then "bg-yellow-500"
                      else "bg-blue-500"
                      end
        %>
        <div class="flex items-center gap-3">
          <span class="w-28 flex-shrink-0 text-gray-500 dark:text-gray-400">monthly</span>
          <span class="w-44 flex-shrink-0 text-gray-800 dark:text-gray-200">$<%= number_with_precision(tenant_budget[:monthly_spend], precision: 2) %> <span class="text-gray-400 dark:text-gray-600">/ $<%= number_with_precision(tenant_budget[:monthly_limit], precision: 2) %></span></span>
          <span class="w-12 flex-shrink-0 text-right text-gray-400 dark:text-gray-600"><%= tenant_budget[:monthly_percentage] %>%</span>
          <div class="flex-1 bg-gray-200 dark:bg-gray-800 rounded-full h-1">
            <div class="<%= bar_color %> h-1 rounded-full transition-all" style="width: <%= monthly_pct %>%"></div>
          </div>
        </div>
      <% else %>
        <div class="flex items-center gap-3">
          <span class="w-28 flex-shrink-0 text-gray-500 dark:text-gray-400">monthly</span>
          <span class="text-gray-800 dark:text-gray-200">$<%= number_with_precision(tenant_budget[:monthly_spend], precision: 2) %></span>
          <span class="text-gray-400 dark:text-gray-600">(no limit)</span>
        </div>
      <% end %>
    </div>

    <%# Per-agent limits if configured %>
    <% if tenant_budget[:per_agent_daily].present? %>
      <div class="mt-3 font-mono text-xs">
        <span class="text-gray-400 dark:text-gray-600">per-agent daily:</span>
        <div class="mt-1 space-y-0.5 pl-2">
          <% tenant_budget[:per_agent_daily].each do |agent, limit| %>
            <div class="flex items-center gap-2">
              <span class="text-gray-900 dark:text-gray-200"><%= agent.to_s.gsub(/Agent$/, "") %></span>
              <span class="text-gray-400 dark:text-gray-600">$<%= number_with_precision(limit, precision: 2) %></span>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
