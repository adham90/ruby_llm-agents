<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
  <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Usage Trends</h3>
    <p class="text-sm text-gray-500 dark:text-gray-400">Daily cost and execution count over time</p>
  </div>

  <div id="usage-trends-chart" class="p-6 h-[350px]"></div>

  <script>
    (function() {
      const trendData = <%= raw trend_data.to_json %>;

      function initTrendsChart() {
        // Prepare data for chart
        const dates = trendData.map(d => d.date);
        const costs = trendData.map(d => parseFloat(d.total_cost) || 0);
        const counts = trendData.map(d => d.count || 0);
        const errors = trendData.map(d => d.error_count || 0);

        Highcharts.chart('usage-trends-chart', {
          chart: {
            type: 'column',
            backgroundColor: 'transparent'
          },
          title: { text: null },
          xAxis: {
            categories: dates,
            labels: {
              style: { color: '#9CA3AF' },
              formatter: function() {
                const date = new Date(this.value);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
              }
            },
            lineColor: 'rgba(156, 163, 175, 0.2)'
          },
          yAxis: [{
            title: { text: 'Cost ($)', style: { color: '#9CA3AF' } },
            labels: {
              style: { color: '#9CA3AF' },
              formatter: function() { return '$' + this.value.toFixed(2); }
            },
            gridLineColor: 'rgba(156, 163, 175, 0.2)',
            min: 0
          }, {
            title: { text: 'Executions', style: { color: '#9CA3AF' } },
            labels: { style: { color: '#9CA3AF' } },
            opposite: true,
            gridLineColor: 'transparent',
            min: 0
          }],
          legend: {
            align: 'center',
            verticalAlign: 'bottom',
            itemStyle: { color: '#9CA3AF' }
          },
          tooltip: {
            shared: true,
            backgroundColor: 'rgba(17, 24, 39, 0.95)',
            borderColor: 'rgba(75, 85, 99, 0.5)',
            style: { color: '#F3F4F6' },
            headerFormat: '<b>{point.key}</b><br/>',
            useHTML: true
          },
          plotOptions: {
            column: {
              borderRadius: 4,
              groupPadding: 0.1
            },
            spline: {
              lineWidth: 2,
              marker: { enabled: true, radius: 3 }
            }
          },
          series: [{
            name: 'Cost',
            type: 'column',
            data: costs,
            color: '#F59E0B',
            tooltip: { valuePrefix: '$', valueDecimals: 4 }
          }, {
            name: 'Executions',
            type: 'spline',
            yAxis: 1,
            data: counts,
            color: '#3B82F6',
            tooltip: { valueSuffix: '' }
          }, {
            name: 'Errors',
            type: 'spline',
            yAxis: 1,
            data: errors,
            color: '#EF4444',
            dashStyle: 'ShortDash',
            tooltip: { valueSuffix: '' }
          }],
          credits: { enabled: false }
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTrendsChart);
      } else {
        initTrendsChart();
      }
    })();
  </script>
</div>
