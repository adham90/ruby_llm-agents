<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
  <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Activity Heatmap</h3>
    <p class="text-sm text-gray-500 dark:text-gray-400">Executions by hour (last 7 days)</p>
  </div>

  <div id="hourly-heatmap-chart" class="p-6 h-[300px]"></div>

  <script src="https://code.highcharts.com/modules/heatmap.js"></script>
  <script>
    (function() {
      const heatmapData = <%= raw hourly_heatmap.to_json %>;

      function initHeatmapChart() {
        // Find max value for color scaling
        const maxVal = Math.max(...heatmapData.data.map(d => d[2]), 1);

        Highcharts.chart('hourly-heatmap-chart', {
          chart: {
            type: 'heatmap',
            backgroundColor: 'transparent'
          },
          title: { text: null },
          xAxis: {
            categories: Array.from({length: 24}, (_, i) => String(i).padStart(2, '0') + ':00'),
            labels: {
              style: { color: '#9CA3AF', fontSize: '10px' },
              step: 2
            },
            lineColor: 'rgba(156, 163, 175, 0.2)',
            title: { text: 'Hour', style: { color: '#9CA3AF' } }
          },
          yAxis: {
            categories: heatmapData.days,
            labels: { style: { color: '#9CA3AF', fontSize: '11px' } },
            title: null,
            reversed: true
          },
          colorAxis: {
            min: 0,
            max: maxVal,
            minColor: 'rgba(59, 130, 246, 0.1)',
            maxColor: '#3B82F6',
            labels: { style: { color: '#9CA3AF' } }
          },
          legend: {
            align: 'right',
            layout: 'vertical',
            verticalAlign: 'middle',
            symbolHeight: 150
          },
          tooltip: {
            backgroundColor: 'rgba(17, 24, 39, 0.95)',
            borderColor: 'rgba(75, 85, 99, 0.5)',
            style: { color: '#F3F4F6' },
            formatter: function() {
              const day = heatmapData.days[this.point.y];
              const hour = String(this.point.x).padStart(2, '0') + ':00';
              return `<b>${day}</b><br/>${hour}: <b>${this.point.value}</b> executions`;
            }
          },
          series: [{
            name: 'Executions',
            borderWidth: 1,
            borderColor: 'rgba(156, 163, 175, 0.2)',
            data: heatmapData.data,
            dataLabels: {
              enabled: false
            }
          }],
          credits: { enabled: false }
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHeatmapChart);
      } else {
        initHeatmapChart();
      }
    })();
  </script>
</div>
