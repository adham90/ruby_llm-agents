# frozen_string_literal: true

class CreateRubyLLMAgentsExecutionDetails < ActiveRecord::Migration<%= migration_version %>
  def change
    create_table :ruby_llm_agents_execution_details do |t|
      t.references :execution, null: false,
                   foreign_key: { to_table: :ruby_llm_agents_executions, on_delete: :cascade },
                   index: { unique: true }

      t.text     :error_message
      t.text     :system_prompt
      t.text     :user_prompt
      t.json     :response,             default: {}
      t.json     :messages_summary,     default: {}, null: false
      t.json     :tool_calls,           default: [], null: false
      t.json     :attempts,             default: [], null: false
      t.json     :fallback_chain
      t.json     :parameters,           default: {}, null: false
      t.string   :routed_to
      t.json     :classification_result
      t.datetime :cached_at
      t.integer  :cache_creation_tokens, default: 0

      t.timestamps
    end
  end
end
