# frozen_string_literal: true

module <%= @root_namespace %>
  module Audio
<%- if class_name.include?("::") -%>
<%- class_name.split("::")[0..-2].each_with_index do |mod, i| -%>
<%= "  " * (i + 2) %>module <%= mod %>
<%- end -%>
<%= "  " * (class_name.split("::").length + 1) %>class <%= class_name.split("::").last %>Transcriber < ApplicationTranscriber
<%- else -%>
    class <%= class_name %>Transcriber < ApplicationTranscriber
<%- end -%>
      # Model configuration
      model "<%= options[:model] %>"
<% if options[:language] -%>
      language "<%= options[:language] %>"
<% end -%>
<% if options[:output_format] != "text" -%>
      output_format :<%= options[:output_format] %>
<% end -%>
<% if options[:cache] -%>

      # Caching
      cache_for <%= options[:cache] %>
<% end -%>

      # Optional: Provide context to improve accuracy
      # Override this method to give the model hints about the audio content
      #
      # def prompt
      #   "Technical discussion about Ruby programming"
      # end

      # Optional: Clean up transcription text
      # Override this method to post-process the transcribed text
      #
      # def postprocess_text(text)
      #   text
      #     .gsub(/\bum\b/i, '')     # Remove filler words
      #     .gsub(/\buh\b/i, '')
      #     .squeeze(' ')             # Remove extra spaces
      # end
<%- if class_name.include?("::") -%>
<%- (class_name.split("::").length + 1).times do |i| -%>
<%= "  " * (class_name.split("::").length + 1 - i) %>end
<%- end -%>
<%- else -%>
    end
<%- end -%>
  end
end
